{% extends "web/template_private.html" %}
{% load static %}

{% block content %}
    <div class="content-wrapper">

        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>Flowcells <small> - select a Flowcell for more information.</small></h1>
        </section>

        <!-- Main content -->
        <section class="content">
            <!-- Main top nav bar -->
            <!--<p class="alert alert-info">Mensagem de teste.</p>-->


                <div class="nav-tabs-custom">
                    <ul class="nav nav-tabs nav-justified">
                        <li class="active"><a href="#tab-active-flowcells" data-toggle="tab">Active Flowcells</a></li>
                        <li><a href="#tab-all-flowcells" data-toggle="tab">All Flowcells</a></li>
                    </ul>
                </div>
                <div id="messages"></div>


                <div class="tab-content">
                    <div class="tab-pane fade in active box" id="tab-active-flowcells">
                        <div class="box-body">
                            <table id="active-runs" class="table table-bordered table-striped table-hover" style="width: 100%" cellspacing="0" >
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>Name</th>
                                <th>Device</th>
                                <th>Qt Runs</th>
                            </tr>
                            </thead>
                        </table>
                        </div>
                    </div>
                    <div class="tab-pane fade box" id="tab-all-flowcells">
                        <div class="box-body">
                           <table id="all-runs" class="table table-bordered table-striped table-hover" style="width:100%" cellspacing="0" >
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>Name</th>
                                <th>Device</th>
                                <th>Qt Runs</th>
                            </tr>
                            </thead>
                        </table>
                        </div>
                    </div>
                </div>
        </section><!-- /.content -->
    </div><!-- /.content-wrapper -->
{% endblock %}
{% block javascript %}
<script>
    var table_active_runs;
    var table_all_runs;

    $(document).ready(function () {

        table_active_runs = $('#active-runs').DataTable({
            'ajax': {
                'url': "{% url 'flowcell-list-active' %}",
                'dataSrc': function(json){

                    var data = [];

                    for (var i = 0; i < json.length; i++){
                        data.push([json[i].id, json[i].name, json[i].name, json[i].runs.length, json[i].id]);
                    }
                    return data;
                }
            },
            'columnDefs': [
                {
                    'targets': 0,
                    'data': 0,
                    'render': function(data, type, full, meta){
                        return '<a href="/web/private/flowcells/' + data + '/"> See details</a>';
                    }
                },
            ]
        });

        table_all_runs = $('#all-runs').DataTable({
            'ajax': {
                'url': "{% url 'flowcell-list' %}",
                'dataSrc': function(json){
                    var data = [];
                    //console.log(json);
                    var ien = json.length;
                    for (var i = 0; i < ien; i++){
                        data.push([json[i].id, json[i].name, json[i].name, json[i].runs.length, json[i].id]);
                    }
                    return data;
                }
            },
            'columnDefs': [
                {
                    'targets': 0,
                    'data': 0,
                    'render': function(data, type, full, meta){
                        return '<a href="/web/private/flowcells/' + data + '/"> See details</a>';
                    }
                },
                /*{
                    'targets': 3,
                    'data': 0,
                    'render': function(data, type, full, meta){
                        return '<a href="#">Delete</a>';
                    }
                }*/
            ]
        });

    });

    function delete_run(id) {
        $.ajax({
            url: '/api/v1/runs/' + id + '/',
            type: 'GET',
            success: function(data) {

                var csrftoken = Cookies.get('csrftoken');

                $.ajaxSetup({
                    beforeSend: function (xhr, settings) {
                        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                            xhr.setRequestHeader("X-CSRFToken", csrftoken);
                        }
                    }
                });

                $.ajax({
                    url: '/api/v1/runs/' + id + '/',
                    type: 'PUT',
                    'data': {
                        "run_id": data['run_id'],
                        "run_name": data['run_name'],
                        "to_delete": "True",
                    },
                    success: function(data2) {
                        table_active_runs.ajax.reload();
                        table_all_runs.ajax.reload();
                    }
                });
            },
        });
    }

</script>
{% endblock %}

var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
var FlowcellNotificationController=function(a){this._axiosInstance=axios.create({headers:{"X-CSRFToken":getCookie("csrftoken")}});this._flowcellId=a;this._contigSet={};this._referenceSet=new Set(['<option id="ref-place-holder" value="-1" selected>Please Choose</option>']);this._referenceSelect=$("#reference");this._contigSelect=$("#chromosome");this._table=$(".extantNotif");this.options={backdrop:"true"};this._formData=new FormData;this._table=null;this._disabledNotificationsHTML={};this._type2Id=
{arti:["list-artic-top","list-artic"],suff:["list-artic-top","list-artic"]};this._addListenerToForms()};FlowcellNotificationController.prototype._referenceOnChange=function(a){a=$(a.currentTarget).val();this._referenceSelect.find("#ref-place-holder").remove();this._contigSelect.attr("disabled",!1);this._contigSelect.html([].concat($jscomp.arrayFromIterable(this._contigSet[a])).join(""))};
FlowcellNotificationController.prototype._getReferencesForCoverage=function(){var a=this;this._axiosInstance.get("/api/v1/communication/"+this._flowcellId+"/conditions/references").then(function(b){b=b.data;var c=$("#list-mapping-top");Object.keys(b).length?(c.removeClass("disabled"),c.css("cursor","pointer"),c.removeAttr("title")):(c.addClass("disabled"),c.css("cursor","not-allowed"),c.attr("title","No mapping tasks running"));Object.entries(b).forEach(function(d){var e=$jscomp.makeIterator(d);d=
e.next().value;e=e.next().value;a._referenceSet.add('<option value="'+e[0][2]+'">'+d+"</option>");e.forEach(function(g){var f=$jscomp.makeIterator(g);g=f.next().value;var h=f.next().value;f=f.next().value;f in a._contigSet||(a._contigSet[f]=new Set,a._contigSet[f].add('<option id="place-holder" value="0" selected>Genome Coverage</option>'));a._contigSet[f].add('<option value="'+h+'">'+g+"</option>")})});a._referenceSelect.html([].concat($jscomp.arrayFromIterable(a._referenceSet)).join(""))})};
FlowcellNotificationController.prototype._addListenerToForms=function(){var a=this;$("#reference").on("change",function(b){a._referenceOnChange(b)});$(".notification-form").on("submit",function(b){a._postNotificationCreation(b,a)});$("#multi-form-submit").on("click",this.submitForms)};
FlowcellNotificationController.prototype._disableExtantNotifications=function(){var a=this,b=this;this._axiosInstance.get("/api/v1/communication/"+this._flowcellId+"/conditions/extant-types").then(function(c){c=c.data;c.includes("arti")&&c.includes("suff")&&!Object.prototype.hasOwnProperty.call(a._disabledNotificationsHTML,"list-artic-top")&&(b._disabledNotificationsHTML["list-artic-top"]=$("#list-artic-top")[0].outerHTML,$("#list-artic-top").remove(),$("#list-artic").css("display","none"));c.forEach(function(d){var e=
$("#"+d+"-btn");["cov","arti","suff"].includes(d)?["arti","suff"].includes(d)&&$("#"+d).find("#"+d).prop("disabled",!0):Object.prototype.hasOwnProperty.call(a._disabledNotificationsHTML,d)||(e.removeClass("active"),b._disabledNotificationsHTML[d]=e[0].outerHTML,e.remove())});$("#"+$("#list-tab-top").children().first().attr("id")).tab("show")})["catch"](function(c){console.error(c)})};FlowcellNotificationController.prototype.submitForms=function(){$("#arti").submit();$("#suff").submit()};
FlowcellNotificationController.prototype._postNotificationCreation=function(a,b){var c=new FormData;a.preventDefault();$(a.currentTarget).find(".noti-control").each(function(d,e){var g="checkbox"===e.type?$(e).prop("checked"):$(e).val();g&&(c.has("flowcell")||(c.append("notification_type",$(a.currentTarget).attr("id")),c.append("flowcell",b._flowcellId)),c.append(e.id.replace("-","_"),g))});axios({url:"/api/v1/communication/conditions/create-condition/",data:c,headers:{"X-CSRFToken":getCookie("csrftoken"),
"Content-Type":"multipart/form-data; boundary="+c._boundary},method:"POST"}).then(function(d){b._disableExtantNotifications();b.getNotificationsForTable();$(a.currentTarget)[0].reset();b._formData=new FormData})["catch"](function(d){console.error(d);b._formData=new FormData})};
FlowcellNotificationController.prototype.getNotificationsForTable=function(a){var b=this;this._table=$(".extantNotif");$.fn.DataTable.isDataTable(this._table)?this._table.DataTable().ajax.reload(null,!1):this._table.DataTable({createdRow:function(c,d,e){$(c).addClass("notification-row");$(c).last().on("click",function(g){b._deleteNotification(d.id,d.notification_type)})},language:{infoEmpty:"No records available."},ajax:{url:"/api/v1/communication/messages/conditions",method:"GET",data:{flowcellId:a}},
columns:[{data:"id"},{data:"notification_type"},{data:"upper_limit"},{data:"lower_limit"},{data:"completed"},{data:"ref_name"},{data:"chrom_line_name"},{data:"coverage_target"},{data:null,orderable:!1,width:"15%",render:function(c,d,e){return'<a id="delete_'+c.id+'"><i class="fa fa-times task-icon"></i> Delete </a>'}}]})};
FlowcellNotificationController.prototype._deleteNotification=function(a){var b=this,c=getCookie("csrftoken");axios.create({headers:{"X-CSRFToken":c}})["delete"]("/api/v1/communication/messages/conditions",{params:{pk:a}}).then(function(d){d=d.data;$(".extantNotif").DataTable().ajax.reload(null,!1);["arti","suff"].includes(d)?$("#list-tab-tasks").find("#list-artic-top").length||($("#list-tab-tasks").append(b._disabledNotificationsHTML["list-artic-top"]),$("#list-artic").css("display","block"),$("#"+
d).prop("disabled",!1)):"cov"!==d&&$("#list-tab-top").append(b._disabledNotificationsHTML[d])})["catch"](function(d){console.error(d)})};FlowcellNotificationController.prototype.updateTab=function(){this.getNotificationsForTable(this._flowcellId);this._disableExtantNotifications();this._getReferencesForCoverage()};
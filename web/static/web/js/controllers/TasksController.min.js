var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
var TasksController=function(a){this._flowcellId=a;this._selectJobType=$("#job-type-select");this._selectReference=$("#reference-select");this._target_set=null;this._messageView=new MessageView(document.querySelector("#messageView"));this._reactivatemessageView=new MessageView(document.querySelector("#messageViewReactivate"),"warning");this._flowcellName=$("#name-flowcell").html();this._fromDatabase=$("#from-database");this._axiosInstance=axios.create({headers:{"X-CSRFToken":getCookie("csrftoken")}});
this._selectOptionsList=new Set;this._selectOptionsList.add('<option value="-1">-- Please Choose --</option>');this._referenceSelectOptionsList=new Set;this._referenceSelectOptionsList.add('<option value="-1">-- Please Choose --</option>');this._targetSetSet=new Set;this._addListenerToTasksForm();this._addListenerToReactivateButton();this._targetSetSet.add('<option value="-1">-- Please Choose --</option>');this._runFromDatabase=$("#run-from-database");this._90Input=$("#90-input-og");this._95Input=
$("#95-input-og");this._99Input=$("#99-input-og");this._fireInputs=[this._90Input,this._95Input,this._99Input];this._interval=setInterval(this._flowcellTaskHistoryTable,3E4,this._flowcellId);$(window).on("unload",function(){console.log("clearing task interval");clearInterval(this._interval)})};TasksController.prototype._addListenerToRunFromDatabaseHelp=function(){$("#run-from-database").hover($(this))};
TasksController.prototype._addListenerToReactivateButton=function(){var a=this;$("#reactivate_flowcell").on("click",function(){a.reactivateFlowcell(event)})};TasksController.prototype._addListenerToTasksForm=function(){var a=this;$("#post-form-task-create").on("submit",function(){a._createNewJob(event)})};TasksController.prototype.updateTab=function(){this._flowcellTaskHistoryTable(this._flowcellId);this._loadTasksForm()};
TasksController.prototype._submitDeleteTask=function(a){this._axiosInstance.post("/api/v1/tasks/",{flowcell:a.flowcellId,reference:a.referenceId,job_type:a.jobTypeId,target_set:a.targetSetId}).then(function(b){console.log(b);"11"===a.jobTypeId&&(window.location.href="/",$("#basicModal").modal(),setTimeout(function(){$("#basicModal").modal("hide")},6E3))})["catch"](function(b){$("#basicModal").modal()})};
TasksController.prototype._submitArticFire=function(){var a={};this._fireInputs.forEach(function(b){console.log(b.val());console.log(b.attr("id").split("-").slice(0,2).join("-"));a[b.attr("id").split("-").slice(0,2).join("-")]=b.val()});this._axiosInstance.post("/api/v1/artic/"+this._flowcellId+"/firing-conditions",a).then(function(b){console.log(b.data)})["catch"](function(b){console.error(b)})};
TasksController.prototype._createNewJob=function(a){var b=this,c=this._fromDatabase[0].checked,d="-1"===this._selectReference.val()?null:this._selectReference.val(),f=this._selectJobType.val(),e=this._selectReference.val(),h=new MinotourTask(this._flowcellId,f,d,e,c),l=$(".tasktable"),m=this;a.preventDefault();"11"===h.jobTypeId?($("#confirm-submit").modal("show"),$("#flowcell-name").on("input",function(g){var k=$(".fa-galactic-republic");console.log(b._flowcellName);g.target.value===b._flowcellName?
(k.removeClass("disallowed"),k.addClass("allowed"),$("#submit-task-delete").attr("disabled",!1)):(k.removeClass("allowed"),k.addClass("disallowed"),$("#submit-task-delete").attr("disabled",!0))}),$("#submit-task-delete").on("click",function(g){$("#confirm-submit").modal("hide");b._submitDeleteTask(h)})):("16"===h.jobTypeId&&(new Promise(function(g,k,n,p){$("#set-artic-fire").modal("show");$("#submit-artic-choices").click(function(){g("user clicked")});$("#confirmation .btn-danger").click(function(){k("user clicked cancel")})})).then(function(g){m._postTask(h,
l);m._submitArticFire();$("#set-artic-fire").modal("hide");console.log(g)})["catch"](function(g){console.log("user clicked cancel",g)}),"16"!==h.jobTypeId&&this._postTask(h,l))};
TasksController.prototype._postTask=function(a,b){var c=this;this._axiosInstance.post("/api/v1/tasks/",{flowcell:a.flowcellId,reference:a.referenceId,job_type:a.jobTypeId,target_set:a.targetSetId,from_database:a.fromDatabase}).then(function(d){c._messageView.update("Task successfully created!");b.DataTable().ajax.reload(null,!1)})["catch"](function(d){console.error(d);401===d.response.status?alert("Permission denied."):c._messageView.update("Problem creating task: "+("object"===typeof d.response.data.message?
d.response.data.message.non_field_errors[0]:d.response.data.message))})};TasksController.prototype.reactivateFlowcell=function(a){var b=this;a.preventDefault();this._axiosInstance.post("/api/v1/flowcells/"+this._flowcellId+"/reactivate/").then(function(c){b._reactivatemessageView.update("Flowcell successfully reactivated")})["catch"](function(c){console.error(c);b._reactivatemessageView.update("Issue updating flowcell - "+c.response.data)})};
TasksController.prototype.performActionOnTask=function(a,b,c){var d=this;a={1:"Reset",2:"Pause",3:"Delete"}[c];var f=$(".tasktable");"Delete"===a&&(document.getElementById(a.toLowerCase()+"_"+b).style.visibility="hidden");d._messageView.update(a+"ing task with ID "+b+" - please wait for confirmation");this._axiosInstance.post("/api/v1/reads/tasks/action",{flowcellJobId:b,actionType:c}).then(function(e){d._messageView.update(e.data);f.DataTable().ajax.reload(null,!1)})["catch"](function(e){console.error(e);
d._messageView.update("Something went wrong. Please check the following message: "+e.response.data)})};
TasksController.prototype._flowcellTaskHistoryTable=function(a){var b=$(".tasktable");$.fn.DataTable.isDataTable(b)?b.DataTable().ajax.reload(null,!1):b.DataTable({ajax:{url:"/api/v1/tasks/?search_criteria=flowcell&search_value="+a.toString(),method:"GET",async:!0,error:function(c,d,f){console.error(c);console.error(f)}},columns:[{data:"id"},{data:"task_type_name"},{data:"read_count"},{data:"running"},{data:"complete"},{data:"reference_name"},{data:"server_initiated"},{data:"from_database"},{data:null,
orderable:!1,width:"15%",render:function(c,d,f){return c.server_initiated?["<a></a>"]:['<a class="btn icon-task"  id="pause_'+c.id+'" onclick="flowcellController.flowcellTabController.tasksController.performActionOnTask(event, '+c.id+', 2)" ><i class="fa fa-'+c.icon+' task-icon"></i> '+c.iconText+' </a>\u00b7\n                                <a class="btn icon-task" id="reset_'+c.id+'" onclick="flowcellController.flowcellTabController.tasksController.performActionOnTask(event, '+c.id+', 1)"><i class="fa fa-recycle task-icon"></i> Reset </a>\u00b7\n                                <a class="btn icon-task" id="delete_'+
c.id+'" onclick="flowcellController.flowcellTabController.tasksController.performActionOnTask(event, '+c.id+', 3)"><i class="fa fa-times task-icon"></i> Delete </a>']}}]})};
TasksController.prototype._loadTasksForm=function(){var a=this,b=this._selectReference;this._selectJobType.on("change",function(c){c=a._selectJobType.val();var d=$("#select-label");"10"===c?(d.html("Target Sets"),b.empty(),axios.get("/api/v1/metagenomics/targetsets").then(function(f){f.data.forEach(function(e){a._targetSetSet.add('<option value="'+e.target_set+'">'+e.target_set+"</option>")});b.html([].concat($jscomp.arrayFromIterable(a._targetSetSet)).join(""))}),b.attr("disabled",!1)):(b.attr("disabled",
!0),["4","16"].includes(c)?(b.attr("disabled",!1),a._runFromDatabase.css("display","inline-flex")):a._runFromDatabase.css("display","none"),"Reference"!==d.html()&&(d.html("Reference"),axios.get("/api/v1/reference/").then(function(f){f.data.data.forEach(function(e){a._referenceSelectOptionsList.add('<option value="'+e.id+'">'+e.name+"</option>")});b.html([].concat($jscomp.arrayFromIterable(a._referenceSelectOptionsList)).join(""))})))});axios.get("/api/v1/reads/tasktypes/").then(function(c){c.data.data.forEach(function(d){a._selectOptionsList.add('<option value="'+
d.id+'">'+d.name+"</option>")});a._selectJobType.html([].concat($jscomp.arrayFromIterable(a._selectOptionsList)).join(""))});axios.get("/api/v1/reference/").then(function(c){c.data.data.forEach(function(d){a._referenceSelectOptionsList.add('<option value="'+d.id+'">'+d.name+"</option>")});b.html([].concat($jscomp.arrayFromIterable(a._referenceSelectOptionsList)).join(""))})};
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(b){return b.raw=b};$jscomp.createTemplateTagFirstArgWithRaw=function(b,a){b.raw=a;return b};$jscomp.arrayIteratorImpl=function(b){var a=0;return function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.makeIterator=function(b){var a="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];return a?a.call(b):$jscomp.arrayIterator(b)};
var LiveMinKnowController=function(b){this._flowcellId=b;this._axiosInstance=axios.create({headers:{"X-CSRFToken":getCookie("csrftoken")}});this._lastMinionRunStatsId=0;this._liveYieldChart=makeLiveChart("chart-yield","Yield Over Time","cumulative yield");this._livePoreStatesChart=makeAreaPlot("pore-states","Pore States","Pore States");this._liveHistogramChart=makeLiveHistogram("live-histogram","Histogram of Read Lengths (Events)","test");this._liveOccupancyChart=makeLiveChart("live-occupancy","% Occupancy Over Time",
"% Occupancy");this._liveInStrandChart=makeLiveChart("live-strand","Strands in pore counts","Number of pores in strand/single");this._liveTemperatureChart=makeLiveChart("live-temperature","Temperature Over Time","\u00b0Celcius");this._liveVoltageChart=makeLiveChart("live-voltage","Voltage Over Time","mV");this._histogramHistory=null;this._first=!0;"live-event-data"===getSelectedTab()&&this._makePageUnscrollable();$("#loader-wrapper").css("width",$("#tab-live-event-data").css("width"))};
LiveMinKnowController.prototype._prepareHistogramSlider=function(){var b=this;$("#histogram-date-picker").on("change",function(a){a=parseInt($("#"+a.currentTarget.id).val());b._updateLiveHistogram(b._histogramHistory,a)})};LiveMinKnowController.prototype._makePageUnscrollable=function(){$("html").addClass("disable-scroll")};LiveMinKnowController.prototype._revealPage=function(){$("#tab-live-event-data").addClass("loaded");$("html").removeClass("disable-scroll")};
LiveMinKnowController.prototype.updateTab=function(){$("#tab-live-event-data").hasClass("loaded")||this._makePageUnscrollable();this.fetchLiveEventsData(this._flowcellId,this)};
LiveMinKnowController.prototype._updateLiveHistogram=function(b,a){var c=b[a].histogram_series.findIndex(function(f){return!0===f.n50});$("#histogram-date-picker").attr({max:""+(b.length-1),value:""+a});$("#displayed-date").html(""+(new Date(b[a].sample_time)).toGMTString());this._liveHistogramChart.series[0].setData(b[a].histogram_series);this._liveHistogramChart.xAxis[0].setCategories(b[a].categories);this._liveHistogramChart.xAxis[0].removePlotBand("plot-band-1");this._liveHistogramChart.xAxis[0].addPlotBand({from:c-
.5,to:c+.5,color:"#FCFFC5",id:"plot-band-1"});this._liveHistogramChart.xAxis[0].removePlotBand("plot-band-2");this._liveHistogramChart.xAxis[0].addPlotBand({color:"black",width:2,dashStyle:"longdashdot",value:c,label:{text:"Estimated Read N50",align:"left",rotation:0,x:16},id:"plot-band-2"});this._liveHistogramChart.reflow()};
LiveMinKnowController.prototype.updateLiveTabChart=function(b,a,c){var f=!1;b.forEach(function(d){if(a.series.findIndex(function(e){return e.name===d.name})+1){var g=a.series.find(function(e){return e.name===a.name});d.length>g.length&&(150>d.length-g.length?d.data.forEach(function(e){g.addPoint(e,!1)}):g.setData(d.data,!1),f=!0)}else a.addSeries(d,!1),c.forEach(function(e){var h=$jscomp.makeIterator(e);e=h.next().value;h=h.next().value;a.xAxis[0].addPlotLine({label:{text:"Run: "+e,x:10,verticalAlign:"top",
style:{color:"blue",fontSize:".8rem",fontFamily:"arial"}},color:"red",value:h,dashStyle:"longdashdot",width:2})}),f=!0});f&&a.redraw()};
LiveMinKnowController.prototype.fetchLiveEventsData=function(b,a){"live-event-data"===getSelectedTab()&&a._axiosInstance.get("/api/v1/reads/flowcells/"+b+"/runstats/"+a._lastMinionRunStatsId).then(function(c){if(206!==c.status){var f=a._first?c.data.histogram_history.length-1:parseInt($("#histogram-date-picker").val()),d=c.data.run_info;console.log(d);a._first=!1;a._histogramHistory=c.data.histogram_history;a.updateLiveTabChart(c.data.yield_history,a._liveYieldChart,d);a.updateLiveTabChart(c.data.pore_history,
a._livePoreStatesChart,d);a._prepareHistogramSlider();a._updateLiveHistogram(c.data.histogram_history,f);a.updateLiveTabChart(c.data.occupancy_history,a._liveOccupancyChart,d);a.updateLiveTabChart(c.data.in_strand_history,a._liveInStrandChart,d);a.updateLiveTabChart(c.data.temperature_history,a._liveTemperatureChart,d);a.updateLiveTabChart(c.data.voltage_history,a._liveVoltageChart,d);a._revealPage();a._lastMinionRunStatsId=c.data.last_minion_run_stats_id}})};